{
    "id": "75bf9902-0789-47c1-a5d8-f57046aa72df",
    "name": "Malware in the recycle bin",
    "description": "Finding attackers hiding malware in the recycle bin.  Read more here: https://azure.microsoft.com/blog/how-azure-security-center-helps-reveal-a-cyberattack/.",
    "techniques": ["Execution", "DefenseEvasion"],
    "query": "let ProcessCreationEvents=() {\n    let processEvents=SecurityEvent\n    | where EventID==4688\n    | project  TimeGenerated, ComputerName=Computer, AccountName=SubjectUserName, AccountDomain=SubjectDomainName, FileName=tostring(split(NewProcessName, \"\\\\\")[-1]), ProcessCommandLine = CommandLine, InitiatingProcessFileName=ParentProcessName;\n    processEvents\n};\nProcessCreationEvents \n| where FileName in~('cmd.exe','ftp.exe','schtasks.exe','powershell.exe','rundll32.exe','regsvr32.exe','msiexec.exe')\n| where ProcessCommandLine contains ':\\recycler'\n| project TimeGenerated, ComputerName, ProcessCommandLine"
}